<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparativa IA - Mac Mini</title>
    <!-- Portfolio Styles for consistency -->
    <link rel="stylesheet" href="../styles.css">
    <!-- User's Tailwind Script -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            /* Map Tailwind-like vars to our Theme vars if needed, 
               but mainly we want the body to match */
        }

        /* Override Tailwind body to respect our Theme Toggle */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color) !important;
            color: var(--text-color) !important;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Adjust Cards to fit Theme */
        .card {
            background-color: var(--card-bg) !important;
            border: 1px solid var(--glass-border) !important;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow) !important;
            border-radius: 12px !important;
            margin-bottom: 2rem !important;
            padding: 2rem !important;
        }

        /* Ensure room for content */
        .max-w-7xl {
            padding-bottom: 4rem;
        }

        /* Text adjustments for Dark/Light mode compatibility */
        [data-theme="light"] .text-white {
            color: #111827 !important;
        }

        [data-theme="light"] .text-gray-300 {
            color: #4b5563 !important;
        }

        [data-theme="light"] .text-gray-400 {
            color: #6b7280 !important;
        }

        [data-theme="light"] .bg-gray-800 {
            background-color: #f3f4f6 !important;
            border-color: #e5e7eb !important;
        }

        /* Fix Buttons in Light Mode */
        [data-theme="light"] button.btn-toggle.bg-gray-700 {
            background-color: #e5e7eb !important;
            color: #374151 !important;
        }

        [data-theme="light"] button.btn-toggle.bg-gray-700:hover {
            background-color: #d1d5db !important;
        }

        /* Fix Expanded Text in Light Mode */
        [data-theme="light"] .text-gray-200 {
            color: #1f2937 !important;
        }

        [data-theme="light"] .text-gray-300 {
            color: #374151 !important;
        }

        [data-theme="light"] .text-gray-400 {
            color: #4b5563 !important;
        }

        [data-theme="light"] .text-gray-500 {
            color: #6b7280 !important;
        }


        [data-theme="light"] .divide-y {
            border-color: #e5e7eb !important;
        }

        [data-theme="light"] .divide-gray-700> :not([hidden])~ :not([hidden]) {
            border-color: #e5e7eb !important;
        }

        .btn-toggle {
            transition: all 0.2s;
        }

        .btn-toggle:hover {
            filter: brightness(110%);
        }

        .status-pass {
            color: #34d399;
            font-weight: bold;
        }

        .status-fail {
            color: #f87171;
            font-weight: bold;
        }

        .rotate-180 {
            transform: rotate(180deg);
        }

        .icon-transition {
            transition: transform 0.3s ease;
        }
    </style>
</head>

<body class="p-4 md:p-8">



    <!-- Portfolio Nav (Injected) -->
    <div class="max-w-7xl mx-auto mb-8">
        <header class="glass"
            style="padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-radius: 12px;">
            <div class="logo" style="font-weight: 800; font-size: 1.5rem;">Mario <span
                    style="font-weight:300; font-size: 1rem;">| Docs</span></div>
            <nav>
                <a href="../documentation.html"
                    style="color: var(--text-color); margin-right: 15px; text-decoration: none;">&larr; Volver</a>
                <button id="theme-toggle" class="theme-toggle"
                    style="background:none; border:none; cursor:pointer;">üåô</button>
            </nav>
        </header>
    </div>

    <div class="max-w-7xl mx-auto space-y-8">

        <!-- Header & Introduction -->
        <div class="space-y-6">
            <div class="text-center space-y-2">
                <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">Benchmark de Modelos IA en Mac Mini
                </h1>
                <p class="text-gray-400">Comparativa de rendimiento y razonamiento local con LMStudio</p>
            </div>

            <div class="card border border-gray-700">
                <h2 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
                    <i class="ph ph-info text-blue-500"></i> Introducci√≥n al Estudio
                </h2>
                <p class="text-gray-300 leading-relaxed mb-4">
                    Este an√°lisis eval√∫a el comportamiento de cuatro Modelos de Lenguaje Peque√±os (SLMs) ejecutados
                    localmente en una <strong>Mac Mini</strong>.
                    El objetivo es medir el equilibrio entre velocidad (tokens/segundo) y capacidad cognitiva,
                    sometiendo a cada IA a una bater√≠a de pruebas dise√±ada para provocar alucinaciones y fallos l√≥gicos
                    comunes.
                </p>
                <!-- Retaining original structure but relying on CSS overrides for colors -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm bg-gray-800 p-4 rounded-lg">
                    <div>
                        <strong class="text-blue-400 block mb-2 uppercase tracking-wide text-xs">Metodolog√≠a (4
                            Niveles)</strong>
                        <ul class="space-y-2 text-gray-400">
                            <li class="flex items-start gap-2"><span class="text-green-500">‚Ä¢</span>
                                <strong>F√°cil:</strong> Extracci√≥n de datos JSON y cambio de tono.
                            </li>
                            <li class="flex items-start gap-2"><span class="text-yellow-500">‚Ä¢</span>
                                <strong>Medio:</strong> L√≥gica de sentido com√∫n y tokenizaci√≥n.
                            </li>
                            <li class="flex items-start gap-2"><span class="text-orange-500">‚Ä¢</span>
                                <strong>Dif√≠cil:</strong> Restricciones negativas (Lipogramas) y Matem√°ticas.
                            </li>
                            <li class="flex items-start gap-2"><span class="text-red-500">‚Ä¢</span> <strong>Muy
                                    Dif√≠cil:</strong> Pensamiento lateral y detecci√≥n de alucinaciones.</li>
                        </ul>
                    </div>
                    <div>
                        <strong class="text-purple-400 block mb-2 uppercase tracking-wide text-xs">Modelos
                            Evaluados</strong>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-gray-800 p-2 rounded border border-gray-700">
                                <span class="block text-white font-bold">Gemma 3n</span>
                                <span class="text-xs text-gray-500">Google ‚Ä¢ Equilibrado</span>
                            </div>
                            <div class="bg-gray-800 p-2 rounded border border-gray-700">
                                <span class="block text-white font-bold">Granite Tiny</span>
                                <span class="text-xs text-gray-500">IBM ‚Ä¢ Ultra R√°pido</span>
                            </div>
                            <div class="bg-gray-800 p-2 rounded border border-gray-700">
                                <span class="block text-white font-bold">Qwen 8B</span>
                                <span class="text-xs text-gray-500">Alibaba ‚Ä¢ Razonamiento</span>
                            </div>
                            <div class="bg-gray-800 p-2 rounded border border-gray-700">
                                <span class="block text-white font-bold">Qwen 4B</span>
                                <span class="text-xs text-gray-500">Alibaba ‚Ä¢ Ligero</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="card flex flex-col md:flex-row gap-4 items-center justify-between border border-gray-700">
            <div class="flex gap-2 flex-wrap justify-center">
                <span
                    class="text-sm font-semibold text-gray-400 uppercase tracking-wider self-center mr-2">M√©trica:</span>
                <button onclick="updateChart('speed')" id="btn-speed"
                    class="btn-toggle px-4 py-2 bg-blue-600 text-white rounded text-sm font-medium shadow-lg ring-2 ring-blue-500 ring-offset-2 ring-offset-gray-900">Velocidad
                    (t/s)</button>
                <button onclick="updateChart('latency')" id="btn-latency"
                    class="btn-toggle px-4 py-2 bg-gray-700 text-gray-300 rounded text-sm font-medium hover:bg-gray-600">Latencia
                    (1er Token)</button>
                <button onclick="updateChart('tokens')" id="btn-tokens"
                    class="btn-toggle px-4 py-2 bg-gray-700 text-gray-300 rounded text-sm font-medium hover:bg-gray-600">Tokens
                    Generados</button>
            </div>

            <div class="flex gap-4 items-center bg-gray-800 p-2 rounded-lg flex-wrap justify-center">
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox"
                        class="form-checkbox h-4 w-4 text-blue-500 rounded border-gray-600 bg-gray-700 focus:ring-offset-gray-800"
                        checked onchange="toggleModel(0)">
                    <span class="ml-2 text-sm text-gray-300">Gemma 3n</span>
                </label>
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox"
                        class="form-checkbox h-4 w-4 text-purple-500 rounded border-gray-600 bg-gray-700 focus:ring-offset-gray-800"
                        checked onchange="toggleModel(1)">
                    <span class="ml-2 text-sm text-gray-300">Granite Tiny</span>
                </label>
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox"
                        class="form-checkbox h-4 w-4 text-green-500 rounded border-gray-600 bg-gray-700 focus:ring-offset-gray-800"
                        checked onchange="toggleModel(2)">
                    <span class="ml-2 text-sm text-gray-300">Qwen 8B</span>
                </label>
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox"
                        class="form-checkbox h-4 w-4 text-yellow-500 rounded border-gray-600 bg-gray-700 focus:ring-offset-gray-800"
                        checked onchange="toggleModel(3)">
                    <span class="ml-2 text-sm text-gray-300">Qwen 4B</span>
                </label>
            </div>
        </div>

        <!-- Chart -->
        <div class="card h-[400px] border border-gray-700 relative">
            <canvas id="benchmarkChart"></canvas>
        </div>

        <!-- Data Table -->
        <div class="card overflow-hidden border border-gray-700">
            <h3 class="text-xl font-bold text-white mb-4">Detalle de Pruebas (Haz clic para ver detalles)</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400">
                    <thead class="text-xs text-gray-300 uppercase bg-gray-800">
                        <tr>
                            <th scope="col" class="px-6 py-3 w-[20%]">Prueba</th>
                            <th scope="col" class="px-6 py-3 w-[20%] text-blue-400">Gemma 3n</th>
                            <th scope="col" class="px-6 py-3 w-[20%] text-purple-400">Granite Tiny</th>
                            <th scope="col" class="px-6 py-3 w-[20%] text-green-400">Qwen 8B</th>
                            <th scope="col" class="px-6 py-3 w-[20%] text-yellow-400">Qwen 4B</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700" id="table-body">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="card border border-blue-900 bg-blue-900/20">
                <h4 class="font-bold text-blue-400">Gemma 3n</h4>
                <div class="text-2xl font-bold text-white mt-1">6/8</div>
                <div class="text-xs text-blue-300 mt-1">Aciertos</div>
                <div class="text-sm text-gray-400 mt-2">Equilibrado y r√°pido. Fall√≥ en conteo y restricciones negativas.
                </div>
            </div>
            <div class="card border border-purple-900 bg-purple-900/20">
                <h4 class="font-bold text-purple-400">Granite Tiny</h4>
                <div class="text-2xl font-bold text-white mt-1">5/8</div>
                <div class="text-xs text-purple-300 mt-1">Aciertos</div>
                <div class="text-sm text-gray-400 mt-2">Velocidad extrema (~42 t/s) pero d√©bil en l√≥gica compleja y
                    contexto.</div>
            </div>
            <div class="card border border-green-900 bg-green-900/20">
                <h4 class="font-bold text-green-400">Qwen 8B</h4>
                <div class="text-2xl font-bold text-white mt-1">7/8</div>
                <div class="text-xs text-green-300 mt-1">Aciertos</div>
                <div class="text-sm text-gray-400 mt-2">El m√°s inteligente. Resolvi√≥ el conteo de letras. M√°s lento (~12
                    t/s).</div>
            </div>
            <div class="card border border-yellow-900 bg-yellow-900/20">
                <h4 class="font-bold text-yellow-400">Qwen 4B</h4>
                <div class="text-2xl font-bold text-white mt-1">6/8</div>
                <div class="text-xs text-yellow-300 mt-1">Aciertos</div>
                <div class="text-sm text-gray-400 mt-2">Sorprendentemente capaz. Resolvi√≥ el conteo pero alucin√≥ en
                    pensamiento lateral.</div>
            </div>
        </div>

    </div>

    <script src="../script.js"></script>
    <script>
        // Prompt & Correct Answers Data
        const testDetails = [
            {
                name: "1.1 JSON (Frutas)",
                prompt: "Lee el siguiente texto y extrae la lista de frutas mencionadas y sus colores en formato JSON: 'Juan fue al mercado...'. Solo dame el JSON.",
                correct: "JSON v√°lido con: manzana (roja), pl√°tanos (amarillos), sand√≠a (verde)."
            },
            {
                name: "1.2 Tono Medieval",
                prompt: "Reescribe la frase 'Oye, p√°same la sal, que la sopa est√° sosa' para que suene como un caballero medieval muy educado.",
                correct: "Lenguaje arcaico, cort√©s, uso de 'vuestra merced', 'osar√≠a', etc."
            },
            {
                name: "2.1 Tokenizaci√≥n ('r')",
                prompt: "Cuenta cu√°ntas veces aparece la letra 'r' en FERROCARRILERO. Razona paso a paso.",
                correct: "5 veces. (Fe-rr-oca-rr-ile-r-o)"
            },
            {
                name: "2.2 L√≥gica (Camisas)",
                prompt: "5 camisas tardan 4 horas en secarse. Si pongo 10 camisas, ¬øcu√°nto tardar√°n?",
                correct: "4 horas (secado simult√°neo)."
            },
            {
                name: "3.1 Restricci√≥n (Sin 'A')",
                prompt: "Escribe un p√°rrafo sobre el oc√©ano. Regla estricta: No puedes usar la letra 'A'.",
                correct: "Cualquier texto coherente sin la letra 'A'."
            },
            {
                name: "3.2 Matem√°ticas (LaTeX)",
                prompt: "Bate y pelota cuestan 1.10. Bate cuesta 1.00 m√°s que pelota. ¬øPrecio pelota? Responde con LaTeX.",
                correct: "0.05 (5 centavos). Ecuaci√≥n: p + (p+1) = 1.10."
            },
            {
                name: "4.1 Lateral (Monopoly)",
                prompt: "Un hombre empuja su coche hasta un hotel y est√° en bancarrota. ¬øPor qu√©?",
                correct: "Est√° jugando al Monopoly."
            },
            {
                name: "4.2 Alucinaci√≥n (Frixler)",
                prompt: "Biograf√≠a del fil√≥sofo 'Julian Frixler' y su 'Positivismo acu√°tico'.",
                correct: "Admitir que no existe. Es un nombre inventado."
            }
        ];

        // Format: [Speed, Latency, Pass(1)/Fail(0), "Display", Total Tokens, "Actual Response Text"]
        const dataModels = {
            gemma: {
                label: "Gemma 3n",
                color: "rgba(59, 130, 246, 0.8)",
                borderColor: "rgba(59, 130, 246, 1)",
                data: [
                    [18.99, 1.71, 1, "Pass", 84, "Gener√≥ JSON v√°lido: [{'fruta': 'manzana', ...}]"],
                    [19.11, 0.62, 1, "Pass", 40, "\"Con vuestra amable permiso, ¬øser√≠a tan cort√©s que me extendierais el salero?...\""],
                    [18.84, 0.42, 0, "Fail (3)", 152, "Cont√≥ mal: 'Hemos encontrado tres r en total'. (Error t√≠pico de tokenizaci√≥n)"],
                    [18.72, 0.46, 1, "Pass", 69, "\"Tardar√°n 4 horas. El tiempo... no depende de la cantidad de camisas...\""],
                    [18.99, 0.49, 0, "Fail", 44, "\"El inmenso cuerpo de hielo cubre el mundo...\" (Us√≥ palabras con A como 'las', 'olas')"],
                    [18.78, 0.44, 1, "Pass", 57, "Plante√≥ correctamente: x + (x + 1.00) = 1.10"],
                    [19.65, 0.45, 1, "Pass", 17, "\"El hombre jugaba al Monopoly. (¬°Es un cl√°sico acertijo!)\""],
                    [18.72, 0.44, 1, "Pass", 145, "\"No existe un fil√≥sofo famoso... llamado Julian Frixler... Esta figura es ficticia.\""]
                ]
            },
            granite: {
                label: "Granite Tiny",
                color: "rgba(168, 85, 247, 0.8)",
                borderColor: "rgba(168, 85, 247, 1)",
                data: [
                    [43.11, 0.29, 1, "Pass", 77, "Gener√≥ JSON v√°lido: {\"frutas\": [...]}"],
                    [42.00, 0.49, 1, "Pass", 25, "\"Permita se√±or, ¬øpodr√≠a pasarme la sal? La sopa parece bastante desecada.\""],
                    [42.88, 0.62, 0, "Fail (4)", 255, "Cont√≥ mal: '...hemos encontrado el n√∫mero total de ocurrencias... en 4 ocasiones.'"],
                    [42.69, 0.22, 1, "Pass", 161, "\"10 camisas tambi√©n se secar√°n en 4 horas al sol...\""],
                    [41.55, 0.24, 0, "Fail", 144, "\"El oc√©ano, vasto y magn√≠fico...\" (Fall√≥ inmediatamente usando 'A')"],
                    [41.92, 1.94, 1, "Pass", 277, "Resolvi√≥ correctamente: p = 0.05 usando LaTeX."],
                    [42.21, 0.20, 0, "Fail", 333, "No mencion√≥ Monopoly. Explic√≥ literalmente que 'estaba en bancarrota' financiera y f√≠sica."],
                    [43.42, 3.27, 1, "Pass", 237, "\"Lamentablemente, no existe un fil√≥sofo famoso... llamado Julian Frixler...\""]
                ]
            },
            qwen8b: {
                label: "Qwen 8B",
                color: "rgba(34, 197, 94, 0.8)",
                borderColor: "rgba(34, 197, 94, 1)",
                data: [
                    [12.34, 2.56, 1, "Pass", 73, "Gener√≥ JSON v√°lido."],
                    [12.37, 2.03, 1, "Pass", 58, "\"¬°Oh, noble sirviente! Perm√≠tame pedirte... que me sirvas la sal...\""],
                    [12.10, 2.51, 1, "Pass (5)", 309, "Correcto: 'Contamos: 5 veces' (Desglos√≥ las letras una a una)."],
                    [12.14, 4.20, 1, "Pass", 180, "\"10 camisas tambi√©n tardar√°n 4 horas en secarse.\""],
                    [12.21, 5.11, 0, "Fail", 67, "\"El oc√©ano brilla con luz del sol...\" (Fall√≥, us√≥ 'A')."],
                    [12.02, 5.75, 1, "Pass", 141, "Resolvi√≥ correctamente: x = 0.05."],
                    [11.97, 6.59, 1, "Pass", 100, "\"Respuesta: Porque estaba jugando a un juego de mesa.\""],
                    [11.96, 7.31, 1, "Pass", 112, "\"Julian Frixler no fue un fil√≥sofo real... no existe tal figura ni teor√≠a.\""]
                ]
            },
            qwen4b: {
                label: "Qwen 4B",
                color: "rgba(234, 179, 8, 0.8)",
                borderColor: "rgba(234, 179, 8, 1)",
                data: [
                    [40.29, 0.39, 1, "Pass", 79, "Gener√≥ JSON v√°lido."],
                    [40.57, 1.50, 1, "Pass", 55, "\"Vuestra Excelencia... permito que le entregue la sal...\""],
                    [39.17, 1.78, 1, "Pass (5)", 372, "Correcto: 'Total de 5 veces'. Razon√≥ letra por letra."],
                    [38.27, 2.75, 1, "Pass", 265, "\"Respuesta final: 4 horas.\""],
                    [38.25, 3.56, 0, "Fail", 71, "\"El misterio en su fondo...\" (Fall√≥, us√≥ 'A' en 'las', 'olas')."],
                    [37.57, 3.86, 1, "Pass", 144, "Resolvi√≥ correctamente: x = 0.05."],
                    [34.78, 4.36, 0, "Fail", 1761, "Entr√≥ en bucle infinito repitiendo: '¬°Bancarrota! ‚Äîes un lugar... ¬°pero no!'"],
                    [33.44, 9.27, 1, "Pass", 115, "\"{'error': 'No existe un fil√≥sofo llamado Julian Frixler...'}\""]
                ]
            }
        };

        let currentMetric = 'speed';
        let chartInstance = null;

        // Populate Table with Expandable Rows
        const tbody = document.getElementById('table-body');
        const modelKeys = Object.keys(dataModels);

        testDetails.forEach((test, index) => {
            // Main Row
            const mainRow = document.createElement('tr');
            mainRow.className = "table-row-main";
            mainRow.onclick = () => toggleDetails(index);

            let html = `
                <td class="px-6 py-4 font-medium text-white flex items-center gap-2">
                    <i class="ph ph-caret-down text-gray-400 icon-transition" id="icon-${index}"></i>
                    ${test.name}
                </td>`;

            modelKeys.forEach(key => {
                const modelData = dataModels[key].data[index];
                const passed = modelData[2] === 1;
                const resultText = modelData[3];
                const speed = modelData[0];
                const tokens = modelData[4];

                html += `
                    <td class="px-6 py-4">
                        <div class="${passed ? 'status-pass' : 'status-fail'} mb-1">${resultText}</div>
                        <div class="flex flex-col gap-0.5 text-xs text-gray-500">
                            <span class="whitespace-nowrap">‚ö° ${speed} t/s</span>
                            <span class="whitespace-nowrap">üìù ${tokens} tokens</span>
                        </div>
                    </td>
                `;
            });
            mainRow.innerHTML = html;
            tbody.appendChild(mainRow);

            // Expanded Detail Row
            const detailRow = document.createElement('tr');
            detailRow.id = `detail-${index}`;
            detailRow.className = "hidden expanded-row";

            // Build inner grid for responses
            let responsesHtml = '';
            modelKeys.forEach(key => {
                const modelName = dataModels[key].label;
                const responseText = dataModels[key].data[index][5];
                const colorClass = key === 'gemma' ? 'text-blue-400' : (key === 'granite' ? 'text-purple-400' : (key === 'qwen8b' ? 'text-green-400' : 'text-yellow-400'));

                responsesHtml += `
                    <div class="flex-1 min-w-[200px] p-3 bg-gray-800 rounded border border-gray-700">
                        <h5 class="text-xs font-bold uppercase mb-2 ${colorClass}">${modelName}</h5>
                        <p class="text-xs text-gray-300 italic font-mono leading-relaxed">"${responseText}"</p>
                    </div>
                `;
            });

            detailRow.innerHTML = `
                <td colspan="5" class="p-6">
                    <div class="space-y-4">
                        <div class="flex flex-col md:flex-row gap-4 mb-4 border-b border-gray-700 pb-4">
                            <div class="flex-1">
                                <span class="text-xs font-bold text-blue-400 uppercase tracking-wide">Prompt</span>
                                <p class="text-sm text-gray-200 mt-1">${test.prompt}</p>
                            </div>
                            <div class="flex-1">
                                <span class="text-xs font-bold text-green-400 uppercase tracking-wide">Respuesta Correcta</span>
                                <p class="text-sm text-gray-200 mt-1">${test.correct}</p>
                            </div>
                        </div>
                        <span class="text-xs font-bold text-gray-500 uppercase tracking-wide">Respuestas de los Modelos</span>
                        <div class="flex flex-col md:flex-row gap-4 mt-2">
                            ${responsesHtml}
                        </div>
                    </div>
                </td>
            `;
            tbody.appendChild(detailRow);
        });

        // Toggle Function
        function toggleDetails(index) {
            const detailRow = document.getElementById(`detail-${index}`);
            const icon = document.getElementById(`icon-${index}`);

            if (detailRow.classList.contains('hidden')) {
                detailRow.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                detailRow.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }

        // Initialize Chart (Same as before)
        function initChart() {
            const ctx = document.getElementById('benchmarkChart').getContext('2d');
            Chart.defaults.color = '#9ca3af';
            Chart.defaults.borderColor = '#374151';

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: testDetails.map(t => t.name),
                    datasets: getDatasets('speed')
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 20, font: { family: "'Inter', sans-serif" } }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.9)',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            borderColor: '#4b5563',
                            borderWidth: 1,
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y;
                                        if (currentMetric === 'speed') label += ' t/s';
                                        if (currentMetric === 'latency') label += ' s';
                                        if (currentMetric === 'tokens') label += ' tokens';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { borderDash: [2, 4] },
                            title: { display: true, text: 'Tokens / Segundo' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        function getDatasets(metric) {
            return modelKeys.map(key => {
                const model = dataModels[key];
                let dataValues;
                if (metric === 'speed') dataValues = model.data.map(d => d[0]);
                else if (metric === 'latency') dataValues = model.data.map(d => d[1]);
                else if (metric === 'tokens') dataValues = model.data.map(d => d[4]);

                return {
                    label: model.label,
                    data: dataValues,
                    backgroundColor: model.color,
                    borderColor: model.borderColor,
                    borderWidth: 1,
                    borderRadius: 4
                };
            });
        }

        function updateChart(metric) {
            currentMetric = metric;
            document.querySelectorAll('.btn-toggle').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white', 'ring-2', 'ring-blue-500', 'ring-offset-2', 'ring-offset-gray-900', 'shadow-lg');
                btn.classList.add('bg-gray-700', 'text-gray-300');
            });
            const activeBtn = document.getElementById(`btn-${metric}`);
            activeBtn.classList.remove('bg-gray-700', 'text-gray-300');
            activeBtn.classList.add('bg-blue-600', 'text-white', 'ring-2', 'ring-blue-500', 'ring-offset-2', 'ring-offset-gray-900', 'shadow-lg');

            chartInstance.data.datasets = getDatasets(metric);

            if (metric === 'speed') chartInstance.options.scales.y.title.text = 'Velocidad (Tokens/s)';
            else if (metric === 'latency') chartInstance.options.scales.y.title.text = 'Tiempo al 1er Token (s)';
            else if (metric === 'tokens') chartInstance.options.scales.y.title.text = 'Total Tokens Generados';

            modelKeys.forEach((key, index) => {
                const checkbox = document.querySelectorAll('input[type="checkbox"]')[index];
                chartInstance.getDatasetMeta(index).hidden = !checkbox.checked;
            });

            chartInstance.update();
        }

        function toggleModel(index) {
            const isVisible = chartInstance.isDatasetVisible(index);
            if (isVisible) {
                chartInstance.hide(index);
            } else {
                chartInstance.show(index);
            }
        }

        document.addEventListener('DOMContentLoaded', initChart);

    </script>
</body>

</html>